<!DOCTYPE html>
	<html lang="en">
	  <head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<link rel="shortcut icon" href="../../assets/ico/favicon.ico">

		<title>StockSim :Function Space Coding Challange</title>

	<link rel="stylesheet" href="http://getbootstrap.com/dist/css/bootstrap.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>

	<script src="http://code.highcharts.com/stock/highstock.js"></script>
	<script src="http://code.highcharts.com/stock/modules/exporting.js"></script>

	<script>
	$(function() {
		
		Highcharts.setOptions({
			global : {
				useUTC : false
			}
		});
		


	function makeCall(url){
					var response;
					$.ajax({url:url,async:false,cache:false,dataType:"json",success:
						function(data){
							response = data;
						}
					});
					return response;
		}	
		


	function generatePlots(howMany) {
		howMany = howMany >>> 0 || 10;
		var plots = [],
			index;

		for (index = 0; index < howMany; index += 1) {
			plots.push({
				name: 'plot' + index,
				data:  makeCall('http://localhost:5000/giveprices')

			});
		}

		return plots;
	}



		
	// Create the chart
		$('#container').highcharts('StockChart', {
			chart : {
				events : {
					load : function() {
					
					// set up the updating of the chart each second
						var series = this.series[0];
						var series2 = this.series[1];
						var series3 = this.series[2];
							var endValue1 = this.series[0].processedYData[this.series[0].processedYData.length - 2];
							var endValue2 = this.series[1].processedYData[this.series[0].processedYData.length - 2];
							var endValue3 = this.series[2].processedYData[this.series[0].processedYData.length - 2];

						setInterval(function() {
						   
							 var x = (new Date()).getTime(), // current time
							// var url="http://localhost:5000/givenext";
						//	 var url='http://localhost:5000/givenext';
							 
						   // var data2 = this.chart.yAxis[0].series[0].processedYData;
							y3 = makeCall('http://localhost:5000/givenext');
	 //getnxtpt(x,endValue1);
							y1 = makeCall('http://localhost:5000/givenext'); //getnxtpt(x,endValue2);
							y2 =  makeCall('http://localhost:5000/givenext'); //getnxtpt(x,endValue3);
	//						y =  lastpt * ( (Math.exp( (0.095/365) - 0.010*((Math.random()*2) - 1))));;
							
							//var x = (new Date()).getTime(), // current time
							
							
							
						series.addPoint([x, endValue1  + (y3[0])], true, false);
						series2.addPoint([x, endValue2  +(y1[0])], true, false);
						series3.addPoint([x, endValue3 + (y2[0])], true, false);
				
							
							
								$('#reportnew').html('<tr> <td> Company 1 </td> <td>' + Math.round((endValue1+ y3[0])*1000)/1000  +'</td> <td>' + y3[0] + ' </td> '+ '</tr>' + 
								
								'<tr> <td> Company 2 </td> <td>' + Math.round((endValue2+ y1[0])*1000)/1000  +'</td> <td>' + y1[0] + ' </td> '+ '</tr>' +
								
								'<tr> <td> Company 1 </td> <td>' + Math.round((endValue3+ y2[0])*1000)/1000  +'</td> <td>' + y2[0] + ' </td> '+ '</tr>');

						}, 10);
					}
				}
			},
			
			
			  xAxis: {
        	type: 'datetime',
        	dateTimeLabelFormats: {
				second: '%Y-%m-%d<br/>%H:%M:%S',
				minute: '%H:%M',
				hour: '%Y-%m-%d<br/>%H:%M',
				day: '%Y<br/>%m-%d',
				week: '%Y<br/>%m-%d',
				month: '%Y-%m',
				year: '%Y'
			}
			
    	},
			 
			  yAxis: {
				title: {
					text: "Current Price"
				},
			   type: 'logarithmic',

			  // type: 'liner',
			   // reversed:true,
					 
			
			},
		  
			
			rangeSelector: {
			buttons: [{
				count: 1,
				type: 'minute',
				text: '1M'
			}, {
				count: 5,
				type: 'minute',
				text: '5M'
			}, {
				type: 'all',
				text: 'All'
			}],
				//inputEnabled: false,
			//	selected: 0
			//	inputEnabled: $('#container').width() > 480,
		        selected: 1
			},
			
			title : {
				text : 'Live Simulated Stock data'
			},
			
			exporting: {
				enabled: false
			},
			
			plotOptions:{
				series:{
					dataLabels: {
						enabled: true,
					/*	formatter: function() {
				   var s = [];
					
					$.each(this.point, function(i, point) {
						s.push(this.point.y);
					});
					
					return null;
				}  */
						formatter: function() {
						// var data2 = this.chart.yAxis[0].series[0].processedYData;
		
					//	lastpt= this.chart.series[1].data[5];
							 lastpt =  this.y;
					//         return null;
					//		var s = [];
					
				  // $.each(this.points, function(i, point) {
					//   s.push(point.y);
				   // });
					
					return null;

						},
				shared: true
	  
					} 
				}
			},
			
			 tooltip: {
				formatter: function() {
				   var s = [];
					
					$.each(this.points, function(i, point) {
						s.push('<span style="color:#D31B22;font-weight:bold;">'+ point.series.name +' : '+
							point.y +'<span>');
					});
					
					return s.join(' and ');
				},
				shared: true
			},
		

			
			series :generatePlots(3)		
			  
		});

		
		


	});


			

	</script>
	   
	  </head>

	  <body>

	<div class="container" >

	<div id="container"></div>
	<div id="report"></div>
	<div id="company table">

	
	<table class="table">
      <thead>
        <tr>
          <th>Company</th>
          <th>Current Price</th>
          <th>Change </th>
        </tr>
      </thead>
      <tbody id="reportnew" >
        <tr>
          <td>1</td>
          <td>Mark</td>
          <td>Otto</td>
        </tr>
        <tr>
          <td>2</td>
          <td>Jacob</td>
          <td>Thornton</td>
        </tr>
        <tr>
          <td>3</td>
          <td>Larry</td>
          <td>the Bird</td>
        </tr>
      </tbody>
    </table>
    </table>
	
		</div>
	<div id="ajax"></div>
	</div>
	 
		
	  </body>
	</html>
